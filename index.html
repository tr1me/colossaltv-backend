<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>COLOSSALTV Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; background: #111; color: #eee; }
    h1 { color: #0ff; }
    button { margin: 5px; padding: 8px 12px; border: none; cursor: pointer; }
    button:hover { background: #0ff; color: #111; }
    input { margin: 5px; padding: 6px; }
    #profilesList { margin-top: 15px; }
    .log { background: #222; padding: 10px; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>âœ¨ COLOSSALTV Dashboard</h1>

  <!-- Profile Controls -->
  <input id="profileNameInput" type="text" placeholder="Enter profile name" />
  <button id="addProfileBtn">Add Profile</button>
  <button id="deleteProfileBtn">Delete Profile</button>
  <button id="revokeAccessBtn">Revoke Access</button>
  <button id="restoreAccessBtn">Restore Access</button>
  <button id="rotateApiKeyBtn">Rotate API Key</button>
  <button id="refreshProfilesBtn">Refresh Profiles</button>
  <input id="searchProfileInput" type="text" placeholder="Search profiles..." />
  <button id="searchProfileBtn">Search Profile</button>

  <!-- Other Controls -->
  <button id="activityLogsBtn">View Activity Logs</button>
  <button id="apiSettingsBtn">API Settings</button>
  <button id="deviceMapBtn">Device Map</button>

  <!-- Output -->
  <ul id="profilesList"></ul>
  <div id="output" class="log"></div>

  <script>
    const output = document.getElementById('output');

    async function loadProfiles() {
      const res = await fetch('/profiles');
      const profiles = await res.json();
      const list = document.getElementById('profilesList');
      list.innerHTML = '';
      profiles.forEach(p => {
        const li = document.createElement('li');
        li.textContent = p.name;
        list.appendChild(li);
      });
    }

    document.getElementById('addProfileBtn').addEventListener('click', async () => {
      const name = document.getElementById('profileNameInput').value;
      if (!name) return alert('Enter a profile name');
      const res = await fetch('/profiles', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name })
      });
      output.textContent = res.ok ? 'Profile added!' : 'Failed to add profile';
      loadProfiles();
    });

    document.getElementById('deleteProfileBtn').addEventListener('click', async () => {
      const name = document.getElementById('profileNameInput').value;
      if (!name) return alert('Enter profile name to delete');
      const res = await fetch(`/profiles/${name}`, { method: 'DELETE' });
      output.textContent = res.ok ? 'Profile deleted!' : 'Failed to delete profile';
      loadProfiles();
    });

    document.getElementById('revokeAccessBtn').addEventListener('click', async () => {
      const name = document.getElementById('profileNameInput').value;
      const res = await fetch(`/profiles/${name}/revoke`, { method: 'POST' });
      output.textContent = res.ok ? 'Access revoked!' : 'Failed to revoke access';
    });

    document.getElementById('restoreAccessBtn').addEventListener('click', async () => {
      const name = document.getElementById('profileNameInput').value;
      const res = await fetch(`/profiles/${name}/restore`, { method: 'POST' });
      output.textContent = res.ok ? 'Access restored!' : 'Failed to restore access';
    });

    document.getElementById('rotateApiKeyBtn').addEventListener('click', async () => {
      const res = await fetch('/apikey/rotate', { method: 'POST' });
      const data = await res.json();
      output.textContent = res.ok ? `New API Key: ${data.key}` : 'Failed to rotate API key';
    });

    document.getElementById('refreshProfilesBtn').addEventListener('click', loadProfiles);

    document.getElementById('searchProfileBtn').addEventListener('click', async () => {
      const query = document.getElementById('searchProfileInput').value;
      const res = await fetch(`/profiles/search?name=${encodeURIComponent(query)}`);
      const data = await res.json();
      output.textContent = JSON.stringify(data, null, 2);
    });

    document.getElementById('activityLogsBtn').addEventListener('click', async () => {
      const res = await fetch('/logs');
      const data = await res.json();
      output.textContent = JSON.stringify(data, null, 2);
    });

    document.getElementById('apiSettingsBtn').addEventListener('click', async () => {
      const res = await fetch('/api/settings');
      const data = await res.json();
      output.textContent = JSON.stringify(data, null, 2);
    });

    document.getElementById('deviceMapBtn').addEventListener('click', async () => {
      const res = await fetch('/devices');
      const data = await res.json();
      output.textContent = JSON.stringify(data, null, 2);
    });

    // Load profiles on page load
    loadProfiles();
  </script>
</body>
</html>
